{% extends "layouts/clarity.html" %}

{% block pageTitle %}
  {% if mode == 'deepen' %}
    Why is that? – {{ session.title }} – {{ serviceName }}
  {% elseif mode == 'why_else' %}
    And why else do you think? – {{ session.title }} – {{ serviceName }}
  {% elseif mode == 'seed' %}
    What's the main problem? – {{ session.title }} – {{ serviceName }}
  {% else %}
    Add response – {{ session.title }} – {{ serviceName }}
  {% endif %}
{% endblock %}

{% block beforeContent %}
  {{ govukBackLink({
    text: "Back to dashboard",
    href: "/session/" + session.id + "/dashboard"
  }) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <form action="/session/{{ session.id }}/process-response" method="post" novalidate>
      
      {% if parentNode %}
        <input type="hidden" name="parentId" value="{{ parentNode.id }}">
      {% endif %}

      {# Compute a label that mirrors the H1 based on mode #}
      {% set labelText = "Participant's response" %}
      {% if mode == 'deepen' %}
        {% set labelText = "Why is that?" %}
      {% elseif mode == 'why_else' %}
        {% set labelText = "And why else do you think?" %}
      {% elseif mode == 'seed' %}
        {% set labelText = "What's the main problem?" %}
      {% endif %}

      {# Compute a hint that reminds the participant of the context #}
      {% set hintText = "Enter what the participant said. The system will analyse it and suggest if it should be split into multiple nodes." %}
      {% if mode == 'deepen' %}
        {% if parentNode %}
          {% set hintText = "Why do you think “" ~ parentNode.text ~ "”" %}
        {% else %}
          {% set hintText = "Why do you think that?" %}
        {% endif %}
      {% elseif mode == 'why_else' %}
        {% if parentNode %}
          {% set hintText = "Why else do you think “" ~ parentNode.text ~ "”" %}
        {% else %}
          {% set hintText = "Why else do you think that?" %}
        {% endif %}
      {% elseif mode == 'seed' %}
        {% set hintText = "In one sentence: what feels stuck, frustrating, or unclear right now?" %}
      {% endif %}

      {{ govukTextarea({
        label: {
          text: labelText,
          classes: "govuk-label--l"
        },
        hint: {
          text: hintText
        },
        id: "response",
        name: "response",
        rows: 5
      }) }}

      {{ govukButton({
        text: "Analyse response"
      }) }}

    </form>

  </div>

  <div class="govuk-grid-column-one-third">
    <aside class="govuk-prototype-kit-common-templates-related-items" role="complementary">
      <h2 class="govuk-heading-s">
        What happens next?
      </h2>
      <p class="govuk-body-s">
        The system will:
      </p>
      <ul class="govuk-list govuk-!-font-size-16">
        <li>Check if the response contains multiple ideas</li>
        <li>Suggest splitting if needed</li>
        <li>Detect vague language</li>
        <li>Recommend follow-up questions</li>
      </ul>
    </aside>
  </div>
</div>

{% endblock %}
